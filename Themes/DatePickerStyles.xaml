<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!-- Dark Mode Compatible DatePicker Style -->
    <Style x:Key="ThemedDatePicker" TargetType="DatePicker">
        <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
        <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
        <Setter Property="BorderBrush" Value="{DynamicResource Surface2Brush}"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Padding" Value="10,8"/>
        <Setter Property="FontSize" Value="13"/>
        <Setter Property="CalendarStyle">
            <Setter.Value>
                <Style TargetType="Calendar">
                    <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
                    <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
                    <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </Style>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="DatePicker">
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="4"
                            Padding="{TemplateBinding Padding}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Text Display -->
                            <TextBlock Grid.Column="0"
                                       x:Name="PART_TextBox"
                                       Foreground="{DynamicResource TextBrush}"
                                       VerticalAlignment="Center"
                                       Margin="0,0,8,0">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text">
                                            <Setter.Value>
                                                <MultiBinding StringFormat="{}{0:MM/dd/yyyy}">
                                                    <Binding Path="SelectedDate" RelativeSource="{RelativeSource TemplatedParent}"/>
                                                </MultiBinding>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedDate, RelativeSource={RelativeSource TemplatedParent}}" Value="{x:Null}">
                                                <Setter Property="Text" Value="Select date..."/>
                                                <Setter Property="Foreground" Value="{DynamicResource SubtextBrush}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            
                            <!-- Calendar Icon Button -->
                            <Button Grid.Column="1"
                                    x:Name="PART_Button"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Padding="4"
                                    Cursor="Hand">
                                <Path Data="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"
                                      Fill="{DynamicResource SubtextBrush}"
                                      Stretch="Uniform"
                                      Width="16"
                                      Height="16"/>
                            </Button>
                            
                            <!-- Popup for Calendar -->
                            <Popup x:Name="PART_Popup"
                                   AllowsTransparency="True"
                                   Placement="Bottom"
                                   PlacementTarget="{Binding ElementName=PART_Button}"
                                   StaysOpen="False">
                                <Border Background="{DynamicResource SurfaceBrush}"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="8"
                                        Padding="8">
                                    <Border.Effect>
                                        <DropShadowEffect Color="Black" 
                                                          BlurRadius="10" 
                                                          ShadowDepth="2" 
                                                          Opacity="0.3"/>
                                    </Border.Effect>
                                    <Calendar x:Name="PART_Calendar"
                                              Background="{DynamicResource SurfaceBrush}"
                                              Foreground="{DynamicResource TextBrush}"
                                              BorderBrush="{DynamicResource BorderBrush}"
                                              BorderThickness="0"/>
                                </Border>
                            </Popup>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Default DatePicker Style (applies to all DatePickers) -->
    <Style TargetType="DatePicker" BasedOn="{StaticResource ThemedDatePicker}"/>

</ResourceDictionary>
