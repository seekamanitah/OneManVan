# Final Entity Tracking Fix - All Remaining Pages
# This creates a template showing the fix pattern for all 8 remaining pages

Write-Host "??????????????????????????????????????????????????????????????????" -ForegroundColor Cyan
Write-Host "?   Entity Tracking Fix - Remaining 8 Pages Reference Guide     ?" -ForegroundColor Cyan
Write-Host "??????????????????????????????????????????????????????????????????" -ForegroundColor Cyan

Write-Host "`n? COMPLETED (3/11):" -ForegroundColor Green
Write-Host "  1. CustomerEdit" -ForegroundColor White
Write-Host "  2. ProductEdit" -ForegroundColor White
Write-Host "  3. AssetEdit" -ForegroundColor White

Write-Host "`n? REMAINING TO FIX (8/11):" -ForegroundColor Yellow
$remaining = @(
    @{Page="JobEdit"; File="OneManVan.Web/Components/Pages/Jobs/JobEdit.razor"; Line=354; Model="Job"; Props=30},
    @{Page="InvoiceEdit"; File="OneManVan.Web/Components/Pages/Invoices/InvoiceEdit.razor"; Line="TBD"; Model="Invoice"; Props=25},
    @{Page="EstimateEdit"; File="OneManVan.Web/Components/Pages/Estimates/EstimateEdit.razor"; Line="TBD"; Model="Estimate"; Props=25},
    @{Page="InventoryEdit"; File="OneManVan.Web/Components/Pages/Inventory/InventoryEdit.razor"; Line="TBD"; Model="InventoryItem"; Props=20},
    @{Page="SiteEdit"; File="OneManVan.Web/Components/Pages/Sites/SiteEdit.razor"; Line="TBD"; Model="Site"; Props=15},
    @{Page="AgreementEdit"; File="OneManVan.Web/Components/Pages/ServiceAgreements/AgreementEdit.razor"; Line="TBD"; Model="ServiceAgreement"; Props=20},
    @{Page="CompanyEdit"; File="OneManVan.Web/Components/Pages/Companies/CompanyEdit.razor"; Line="TBD"; Model="Company"; Props=15},
    @{Page="EmployeeEdit"; File="OneManVan.Web/Components/Pages/Employees/EmployeeEdit.razor"; Line="TBD"; Model="Employee"; Props=20}
)

foreach ($item in $remaining) {
    Write-Host "  • $($item.Page) - $($item.Props) properties" -ForegroundColor Cyan
}

Write-Host "`n?? FIX PATTERN FOR EACH PAGE:" -ForegroundColor Yellow
Write-Host @"

STEP 1: Find the Load method
????????????????????????????????????????????????????????????
Search for: private async Task Load{EntityName}Async()
Example: private async Task LoadJobAsync()

STEP 2: Identify the broken line
????????????????????????????????????????????????????????????
Look for: model = entity;
Example: model = job;  // ? THIS IS BROKEN

STEP 3: Get all model properties
????????????????????????????????????????????????????????????
Open: OneManVan.Shared/Models/{ModelName}.cs
Example: OneManVan.Shared/Models/Job.cs
List ALL public properties

STEP 4: Replace with new instance
????????????????????????????????????????????????????????????
Replace:
    model = job;  // ? WRONG

With:
    model = new Job
    {
        Id = job.Id,
        Property1 = job.Property1,
        Property2 = job.Property2,
        // ... copy ALL properties
    };  // ? CORRECT

STEP 5: Test the page
????????????????????????????????????????????????????????????
1. Build solution
2. Navigate to entity list
3. Click Edit on existing record
4. Verify form shows data
5. Make a change and save
6. Verify it persists

"@ -ForegroundColor White

Write-Host "`n?? RECOMMENDED APPROACH:" -ForegroundColor Cyan
Write-Host "Fix in this order (by priority):" -ForegroundColor White
Write-Host "  1. JobEdit (high - scheduling)" -ForegroundColor Yellow
Write-Host "  2. InvoiceEdit (high - billing)" -ForegroundColor Yellow
Write-Host "  3. EstimateEdit (high - quotes)" -ForegroundColor Yellow
Write-Host "  4. InventoryEdit (medium - stock)" -ForegroundColor White
Write-Host "  5. SiteEdit (medium - locations)" -ForegroundColor White
Write-Host "  6. AgreementEdit (low - contracts)" -ForegroundColor Gray
Write-Host "  7. CompanyEdit (low - admin)" -ForegroundColor Gray
Write-Host "  8. EmployeeEdit (low - HR)" -ForegroundColor Gray

Write-Host "`n?? TIP:" -ForegroundColor Cyan
Write-Host "To see example properties for each model:" -ForegroundColor White
Write-Host "  code `"OneManVan.Shared/Models/{ModelName}.cs`"" -ForegroundColor Gray

Write-Host "`nPress any key to continue..." -ForegroundColor Gray
$null = $Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")
