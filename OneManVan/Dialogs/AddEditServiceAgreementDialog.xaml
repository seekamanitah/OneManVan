<Window x:Class="OneManVan.Dialogs.AddEditServiceAgreementDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Service Agreement" Height="700" Width="600"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource BackgroundBrush}"
        ResizeMode="NoResize">

    <Window.Resources>
        <Style TargetType="TextBlock" x:Key="SectionHeader">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}"/>
            <Setter Property="Margin" Value="0,15,0,8"/>
        </Style>
        
        <Style TargetType="TextBlock" x:Key="FieldLabel">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{DynamicResource SubtextBrush}"/>
            <Setter Property="Margin" Value="0,0,0,3"/>
        </Style>
        
        <Style TargetType="TextBox" x:Key="ModernTextBoxStyle">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Surface2Brush}"/>
            <Setter Property="Padding" Value="8,6"/>
        </Style>
        
        <Style TargetType="ComboBox" x:Key="ModernComboBoxStyle">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Surface2Brush}"/>
            <Setter Property="Padding" Value="8,6"/>
        </Style>
        
        <Style TargetType="DatePicker" x:Key="ModernDatePickerStyle">
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Surface2Brush}"/>
        </Style>
        
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
        </Style>
        
        <Style TargetType="Button" x:Key="PrimaryButtonStyle">
            <Setter Property="Background" Value="{DynamicResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource BackgroundBrush}"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style TargetType="Button" x:Key="SecondaryButtonStyle">
            <Setter Property="Background" Value="{DynamicResource Surface2Brush}"/>
            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
            <StackPanel>
                <!-- Basic Info -->
                <TextBlock Text="BASIC INFORMATION" Style="{StaticResource SectionHeader}" Margin="0,0,0,8"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="150"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel>
                        <TextBlock Text="Agreement Name *" Style="{StaticResource FieldLabel}"/>
                        <TextBox x:Name="NameTextBox" Style="{DynamicResource ModernTextBoxStyle}"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Margin="10,0,0,0">
                        <TextBlock Text="Type" Style="{StaticResource FieldLabel}"/>
                        <ComboBox x:Name="TypeComboBox" Style="{DynamicResource ModernComboBoxStyle}">
                            <ComboBoxItem Content="Basic" Tag="Basic"/>
                            <ComboBoxItem Content="Standard" Tag="Standard" IsSelected="True"/>
                            <ComboBoxItem Content="Premium" Tag="Premium"/>
                            <ComboBoxItem Content="Annual" Tag="Annual"/>
                            <ComboBoxItem Content="Semi-Annual" Tag="SemiAnnual"/>
                            <ComboBoxItem Content="Quarterly" Tag="Quarterly"/>
                            <ComboBoxItem Content="Custom" Tag="Custom"/>
                        </ComboBox>
                    </StackPanel>
                </Grid>

                <StackPanel Margin="0,10,0,0">
                    <TextBlock Text="Customer *" Style="{StaticResource FieldLabel}"/>
                    <ComboBox x:Name="CustomerComboBox" Style="{DynamicResource ModernComboBoxStyle}"
                              DisplayMemberPath="Name" SelectedValuePath="Id"/>
                </StackPanel>

                <StackPanel Margin="0,10,0,0">
                    <TextBlock Text="Site (optional - leave blank for all sites)" Style="{StaticResource FieldLabel}"/>
                    <ComboBox x:Name="SiteComboBox" Style="{DynamicResource ModernComboBoxStyle}"
                              DisplayMemberPath="FullAddress" SelectedValuePath="Id"/>
                </StackPanel>

                <StackPanel Margin="0,10,0,0">
                    <TextBlock Text="Description" Style="{StaticResource FieldLabel}"/>
                    <TextBox x:Name="DescriptionTextBox" Style="{DynamicResource ModernTextBoxStyle}"
                             AcceptsReturn="True" TextWrapping="Wrap" Height="60"/>
                </StackPanel>

                <!-- Contract Term -->
                <TextBlock Text="CONTRACT TERM" Style="{StaticResource SectionHeader}"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel>
                        <TextBlock Text="Start Date" Style="{StaticResource FieldLabel}"/>
                        <DatePicker x:Name="StartDatePicker" Style="{DynamicResource ModernDatePickerStyle}"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Margin="10,0,0,0">
                        <TextBlock Text="End Date" Style="{StaticResource FieldLabel}"/>
                        <DatePicker x:Name="EndDatePicker" Style="{DynamicResource ModernDatePickerStyle}"/>
                    </StackPanel>
                </Grid>

                <CheckBox x:Name="AutoRenewCheckBox" Content="Auto-renew at expiration" 
                          Margin="0,10,0,0" IsChecked="True"/>

                <!-- Pricing -->
                <TextBlock Text="PRICING" Style="{StaticResource SectionHeader}"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel>
                        <TextBlock Text="Annual Price" Style="{StaticResource FieldLabel}"/>
                        <TextBox x:Name="AnnualPriceTextBox" Style="{DynamicResource ModernTextBoxStyle}"
                                 TextChanged="AnnualPriceTextBox_TextChanged"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Margin="10,0,0,0">
                        <TextBlock Text="Billing Frequency" Style="{StaticResource FieldLabel}"/>
                        <ComboBox x:Name="BillingFrequencyComboBox" Style="{DynamicResource ModernComboBoxStyle}"
                                  SelectionChanged="BillingFrequencyComboBox_SelectionChanged">
                            <ComboBoxItem Content="Annual" Tag="Annual" IsSelected="True"/>
                            <ComboBoxItem Content="Semi-Annual" Tag="SemiAnnual"/>
                            <ComboBoxItem Content="Quarterly" Tag="Quarterly"/>
                            <ComboBoxItem Content="Monthly" Tag="Monthly"/>
                        </ComboBox>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Margin="10,0,0,0">
                        <TextBlock Text="Monthly Price" Style="{StaticResource FieldLabel}"/>
                        <TextBox x:Name="MonthlyPriceTextBox" Style="{StaticResource ModernTextBoxStyle}" 
                                 IsReadOnly="True" Background="{DynamicResource Surface2Brush}"/>
                    </StackPanel>
                </Grid>

                <StackPanel Margin="0,10,0,0">
                    <TextBlock Text="Repair Discount %" Style="{StaticResource FieldLabel}"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="RepairDiscountTextBox" Style="{DynamicResource ModernTextBoxStyle}" Text="15"/>
                        <Slider x:Name="RepairDiscountSlider" Grid.Column="1" Margin="10,0,0,0"
                                Minimum="0" Maximum="50" Value="15" 
                                ValueChanged="RepairDiscountSlider_ValueChanged"/>
                    </Grid>
                </StackPanel>

                <!-- Included Visits -->
                <TextBlock Text="INCLUDED VISITS" Style="{StaticResource SectionHeader}"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel>
                        <TextBlock Text="Visits Per Year" Style="{StaticResource FieldLabel}"/>
                        <ComboBox x:Name="VisitsPerYearComboBox" Style="{DynamicResource ModernComboBoxStyle}">
                            <ComboBoxItem Content="1" Tag="1"/>
                            <ComboBoxItem Content="2" Tag="2" IsSelected="True"/>
                            <ComboBoxItem Content="3" Tag="3"/>
                            <ComboBoxItem Content="4" Tag="4"/>
                            <ComboBoxItem Content="6" Tag="6"/>
                            <ComboBoxItem Content="12" Tag="12"/>
                        </ComboBox>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Margin="10,0,0,0">
                        <TextBlock Text="Visits Used" Style="{StaticResource FieldLabel}"/>
                        <TextBox x:Name="VisitsUsedTextBox" Style="{DynamicResource ModernTextBoxStyle}" Text="0"/>
                    </StackPanel>
                </Grid>

                <!-- Included Services -->
                <TextBlock Text="INCLUDED SERVICES" Style="{StaticResource SectionHeader}"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <CheckBox x:Name="AcTuneUpCheckBox" Content="AC Tune-Up" IsChecked="True" Margin="0,5"/>
                    <CheckBox x:Name="HeatingTuneUpCheckBox" Grid.Column="1" Content="Heating Tune-Up" 
                              IsChecked="True" Margin="0,5"/>
                    
                    <CheckBox x:Name="FilterReplacementCheckBox" Grid.Row="1" Content="Filter Replacement" Margin="0,5"/>
                    <CheckBox x:Name="RefrigerantTopOffCheckBox" Grid.Row="1" Grid.Column="1" 
                              Content="Refrigerant Top-Off" Margin="0,5"
                              Checked="RefrigerantTopOffCheckBox_Changed"
                              Unchecked="RefrigerantTopOffCheckBox_Changed"/>
                    
                    <StackPanel Grid.Row="2" Grid.Column="1" x:Name="RefrigerantLbsPanel" 
                                Visibility="Collapsed" Margin="20,0,0,5">
                        <TextBlock Text="Max lbs included:" FontSize="11"/>
                        <TextBox x:Name="MaxRefrigerantLbsTextBox" Width="60" HorizontalAlignment="Left" Text="2"/>
                    </StackPanel>
                    
                    <CheckBox x:Name="PartsCoverageCheckBox" Grid.Row="3" Content="Limited Parts Coverage" 
                              Margin="0,5" Checked="PartsCoverageCheckBox_Changed"
                              Unchecked="PartsCoverageCheckBox_Changed"/>
                    
                    <StackPanel Grid.Row="3" Grid.Column="1" x:Name="PartsCoveragePanel" 
                                Visibility="Collapsed" Margin="0,5">
                        <TextBlock Text="Max coverage amount:" FontSize="11"/>
                        <TextBox x:Name="MaxPartsCoverageTextBox" Width="80" HorizontalAlignment="Left" Text="500"/>
                    </StackPanel>
                </Grid>

                <!-- Benefits -->
                <TextBlock Text="BENEFITS" Style="{StaticResource SectionHeader}"/>
                
                <CheckBox x:Name="PriorityServiceCheckBox" Content="Priority Service (faster response)" 
                          IsChecked="True" Margin="0,5"/>
                <CheckBox x:Name="WaiveTripChargeCheckBox" Content="Waive Trip Charge on Service Calls" 
                          IsChecked="True" Margin="0,5"/>

                <!-- Scheduling Preferences -->
                <TextBlock Text="SCHEDULING PREFERENCES" Style="{StaticResource SectionHeader}"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel>
                        <TextBlock Text="Preferred Spring Month" Style="{StaticResource FieldLabel}"/>
                        <ComboBox x:Name="SpringMonthComboBox" Style="{DynamicResource ModernComboBoxStyle}">
                            <ComboBoxItem Content="March" Tag="3"/>
                            <ComboBoxItem Content="April" Tag="4" IsSelected="True"/>
                            <ComboBoxItem Content="May" Tag="5"/>
                        </ComboBox>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Margin="10,0,0,0">
                        <TextBlock Text="Preferred Fall Month" Style="{StaticResource FieldLabel}"/>
                        <ComboBox x:Name="FallMonthComboBox" Style="{DynamicResource ModernComboBoxStyle}">
                            <ComboBoxItem Content="September" Tag="9"/>
                            <ComboBoxItem Content="October" Tag="10" IsSelected="True"/>
                            <ComboBoxItem Content="November" Tag="11"/>
                        </ComboBox>
                    </StackPanel>
                </Grid>

                <!-- Notes -->
                <TextBlock Text="NOTES" Style="{StaticResource SectionHeader}"/>
                
                <StackPanel>
                    <TextBlock Text="Terms &amp; Conditions" Style="{StaticResource FieldLabel}"/>
                    <TextBox x:Name="TermsTextBox" Style="{DynamicResource ModernTextBoxStyle}"
                             AcceptsReturn="True" TextWrapping="Wrap" Height="60"/>
                </StackPanel>

                <StackPanel Margin="0,10,0,0">
                    <TextBlock Text="Internal Notes" Style="{StaticResource FieldLabel}"/>
                    <TextBox x:Name="InternalNotesTextBox" Style="{DynamicResource ModernTextBoxStyle}"
                             AcceptsReturn="True" TextWrapping="Wrap" Height="60"/>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>

        <!-- Footer -->
        <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" 
                Padding="20,15" BorderThickness="0,1,0,0" 
                BorderBrush="{DynamicResource Surface2Brush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Status:" Foreground="{DynamicResource SubtextBrush}" Margin="0,0,5,0"/>
                    <ComboBox x:Name="StatusComboBox" Width="120" Style="{StaticResource ModernComboBoxStyle}">
                        <ComboBoxItem Content="Draft" Tag="Draft" IsSelected="True"/>
                        <ComboBoxItem Content="Pending" Tag="Pending"/>
                        <ComboBoxItem Content="Active" Tag="Active"/>
                    </ComboBox>
                </StackPanel>

                <Button Grid.Column="1" Content="Cancel" Click="CancelButton_Click"
                        Style="{StaticResource SecondaryButtonStyle}" Width="100" Margin="0,0,10,0"/>
                <Button Grid.Column="2" Content="Save" Click="SaveButton_Click"
                        Style="{StaticResource PrimaryButtonStyle}" Width="100"/>
            </Grid>
        </Border>
    </Grid>
</Window>
