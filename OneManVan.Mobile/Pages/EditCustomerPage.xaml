<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:behaviors="clr-namespace:OneManVan.Mobile.Behaviors"
             x:Class="OneManVan.Mobile.Pages.EditCustomerPage"
             Title="Edit Customer"
             BackgroundColor="{AppThemeBinding Light={StaticResource LightBackground}, Dark={StaticResource DarkBackground}}">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="12">

            <ActivityIndicator x:Name="LoadingIndicator" 
                             IsVisible="False" 
                             IsRunning="False"
                             Color="{DynamicResource Primary}"
                             Margin="0,8"/>

            <Label Text="Basic Information" FontSize="18" FontAttributes="Bold" Margin="0,8,0,4" TextColor="{AppThemeBinding Light={StaticResource SectionPrimary}, Dark={StaticResource SectionPrimaryDark}}"/>
            <Entry x:Name="NameEntry" Placeholder="Customer Name*"/>
            <Entry x:Name="CompanyNameEntry" Placeholder="Company Name (optional)"/>
            
            <Label Text="Contact" FontSize="18" FontAttributes="Bold" Margin="0,8,0,4" TextColor="{AppThemeBinding Light={StaticResource SectionPrimary}, Dark={StaticResource SectionPrimaryDark}}"/>
            <Entry x:Name="EmailEntry" Placeholder="Email" Keyboard="Email"/>
            <Entry x:Name="PhoneEntry" Placeholder="Phone" Keyboard="Telephone">
                <Entry.Behaviors>
                    <behaviors:PhoneNumberFormattingBehavior/>
                </Entry.Behaviors>
            </Entry>
            <Entry x:Name="SecondaryPhoneEntry" Placeholder="Secondary Phone (optional)" Keyboard="Telephone">
                <Entry.Behaviors>
                    <behaviors:PhoneNumberFormattingBehavior/>
                </Entry.Behaviors>
            </Entry>
            <Entry x:Name="SecondaryEmailEntry" Placeholder="Secondary Email (optional)" Keyboard="Email"/>

            <Label Text="Home Address" FontSize="18" FontAttributes="Bold" Margin="0,8,0,4" TextColor="{AppThemeBinding Light={StaticResource SectionPrimary}, Dark={StaticResource SectionPrimaryDark}}"/>
            <Editor x:Name="HomeAddressEditor" 
                    Placeholder="123 Main St, City, State ZIP" 
                    HeightRequest="80"
                    TextChanged="OnHomeAddressChanged"/>
            
            <!-- Navigate Button (shown when address entered) -->
            <Button x:Name="NavigateButton"
                    Text="Open in Maps"
                    Clicked="OnNavigateClicked"
                    IsVisible="False"
                    BackgroundColor="{DynamicResource Secondary}"
                    Margin="0,0,0,12"/>


            <Label Text="Classification" FontSize="18" FontAttributes="Bold" Margin="0,8,0,4" TextColor="{AppThemeBinding Light={StaticResource SectionPrimary}, Dark={StaticResource SectionPrimaryDark}}"/>
            <Picker x:Name="CustomerTypePicker" Title="Customer Type">
                <Picker.Items>
                    <x:String>Residential</x:String>
                    <x:String>Commercial</x:String>
                    <x:String>Industrial</x:String>
                    <x:String>Government</x:String>
                </Picker.Items>
            </Picker>

            <Picker x:Name="StatusPicker" Title="Status">
                <Picker.Items>
                    <x:String>Active</x:String>
                    <x:String>Inactive</x:String>
                    <x:String>Prospect</x:String>
                    <x:String>VIP</x:String>
                </Picker.Items>
            </Picker>

            <Picker x:Name="PaymentTermsPicker" Title="Payment Terms">
                <Picker.Items>
                    <x:String>Due on Receipt</x:String>
                    <x:String>COD</x:String>
                    <x:String>Net 15</x:String>
                    <x:String>Net 30</x:String>
                    <x:String>Net 45</x:String>
                    <x:String>Net 60</x:String>
                </Picker.Items>
            </Picker>

            <!-- Company Relationship Section -->
            <Label Text="Company Relationship" FontSize="18" FontAttributes="Bold" Margin="0,8,0,4" TextColor="{AppThemeBinding Light={StaticResource SectionPrimary}, Dark={StaticResource SectionPrimaryDark}}"/>
            
            <Grid ColumnDefinitions="*, Auto" ColumnSpacing="8">
                <Border Grid.Column="0" 
                        BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
                        StrokeShape="RoundRectangle 8"
                        Padding="12"
                        HeightRequest="48">
                    <Label x:Name="LinkedCompanyLabel" 
                           Text="No company linked" 
                           TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"
                           VerticalOptions="Center"/>
                </Border>
                <Button Grid.Column="1" 
                        Text="Select" 
                        Clicked="OnSelectCompanyClicked"
                        BackgroundColor="{DynamicResource Primary}"
                        WidthRequest="80"
                        HeightRequest="48"/>
            </Grid>

            <!-- Role and Title (shown when company is linked) -->
            <VerticalStackLayout x:Name="RoleSection" IsVisible="False" Spacing="8">
                <Picker x:Name="RolePicker" Title="Role in Company">
                    <Picker.Items>
                        <x:String>Contact</x:String>
                        <x:String>Owner</x:String>
                        <x:String>Manager</x:String>
                        <x:String>Employee</x:String>
                        <x:String>Technician</x:String>
                        <x:String>Contractor</x:String>
                    </Picker.Items>
                </Picker>
                
                <Entry x:Name="TitleEntry" Placeholder="Job Title (optional)"/>
                <Entry x:Name="DepartmentEntry" Placeholder="Department (optional)"/>
                
                <HorizontalStackLayout Spacing="12">
                    <CheckBox x:Name="IsPrimaryContactCheckBox"/>
                    <Label Text="Primary Contact" VerticalOptions="Center"/>
                </HorizontalStackLayout>

                <Button Text="Remove Company Link" 
                        Clicked="OnRemoveCompanyLinkClicked"
                        BackgroundColor="{AppThemeBinding Light={StaticResource ErrorBrush}, Dark=#DC2626}"
                        TextColor="White"/>
            </VerticalStackLayout>

            <Label Text="Additional Information" FontSize="18" FontAttributes="Bold" Margin="0,8,0,4" TextColor="{AppThemeBinding Light={StaticResource SectionPrimary}, Dark={StaticResource SectionPrimaryDark}}"/>
            <Entry x:Name="TagsEntry" Placeholder="Tags (comma-separated)"/>
            <Editor x:Name="NotesEditor" Placeholder="Notes" HeightRequest="100"/>

            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,16,0,0">
                <Button Text="Cancel" Grid.Column="0" Clicked="OnCancelClicked" BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"/>
                <Button Text="Save Changes" Grid.Column="1" Clicked="OnSaveClicked" BackgroundColor="{DynamicResource Primary}"/>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
