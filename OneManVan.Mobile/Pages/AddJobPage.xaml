<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="OneManVan.Mobile.Pages.AddJobPage"
             Title="New Job"
             BackgroundColor="{AppThemeBinding Light={StaticResource LightBackground}, Dark={StaticResource DarkBackground}}">

    <Grid RowDefinitions="*, Auto">
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Padding="16" Spacing="16">

                <!-- Customer Selection -->
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource LightCardBackground}, Dark={StaticResource DarkCardBackground}}" 
                        StrokeShape="RoundRectangle 12" 
                        Stroke="Transparent"
                        Padding="16">
                    <Border.Shadow>
                        <Shadow Brush="{AppThemeBinding Light=Black, Dark={StaticResource Gray900}}" Offset="0,2" Radius="4" Opacity="0.1"/>
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Customer *" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource SectionPrimary}, Dark={StaticResource SectionPrimaryDark}}" FontAttributes="Bold"/>
                        <Border x:Name="CustomerSelector"
                                BackgroundColor="{AppThemeBinding Light={StaticResource LightInputBackground}, Dark={StaticResource DarkInputBackground}}"
                                StrokeShape="RoundRectangle 8"
                                Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                                Padding="12">
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnSelectCustomerTapped"/>
                            </Border.GestureRecognizers>
                            <Grid ColumnDefinitions="*, Auto">
                                <Label x:Name="CustomerNameLabel" 
                                       Text="Tap to select customer..."
                                       TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"
                                       FontSize="16"
                                       VerticalOptions="Center"/>
                                <Label Grid.Column="1" 
                                       Text=">" 
                                       TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"
                                       VerticalOptions="Center"/>
                            </Grid>
                        </Border>
                        
                        <!-- Selected Customer Details -->
                        <Border x:Name="CustomerDetailsPanel"
                                BackgroundColor="{AppThemeBinding Light={StaticResource PrimarySurface}, Dark={StaticResource Gray600}}"
                                StrokeShape="RoundRectangle 8"
                                Stroke="Transparent"
                                Padding="12"
                                IsVisible="False">
                            <VerticalStackLayout Spacing="4">
                                <Label x:Name="CustomerPhoneLabel" 
                                       FontSize="12" 
                                       TextColor="{AppThemeBinding Light={StaticResource SectionPrimary}, Dark={StaticResource SectionPrimaryDark}}"/>
                                <Label x:Name="CustomerAddressLabel" 
                                       FontSize="12" 
                                       TextColor="{AppThemeBinding Light={StaticResource SectionPrimary}, Dark={StaticResource SectionPrimaryDark}}"/>
                            </VerticalStackLayout>
                        </Border>
                    </VerticalStackLayout>
                </Border>

                <!-- Site Selection (if customer has multiple sites) -->
                <Border x:Name="SiteSection"
                        BackgroundColor="{AppThemeBinding Light={StaticResource LightCardBackground}, Dark={StaticResource DarkCardBackground}}" 
                        StrokeShape="RoundRectangle 12" 
                        Stroke="Transparent"
                        Padding="16"
                        IsVisible="False">
                    <Border.Shadow>
                        <Shadow Brush="{AppThemeBinding Light=Black, Dark={StaticResource Gray900}}" Offset="0,2" Radius="4" Opacity="0.1"/>
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Service Site" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                        <Picker x:Name="SitePicker" Title="Select Site"/>
                    </VerticalStackLayout>
                </Border>

                <!-- Job Details -->
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource LightCardBackground}, Dark={StaticResource DarkCardBackground}}" 
                        StrokeShape="RoundRectangle 12" 
                        Stroke="Transparent"
                        Padding="16">
                    <Border.Shadow>
                        <Shadow Brush="{AppThemeBinding Light=Black, Dark={StaticResource Gray900}}" Offset="0,2" Radius="4" Opacity="0.1"/>
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Job Details" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource SectionPrimary}, Dark={StaticResource SectionPrimaryDark}}"/>

                        <!-- Title -->
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Job Title *" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource SectionPrimary}, Dark={StaticResource SectionPrimaryDark}}" FontAttributes="Bold"/>
                            <Entry x:Name="TitleEntry" 
                                   Placeholder="e.g., AC Not Cooling, Furnace Tune-Up"
                                   FontSize="16"/>
                        </VerticalStackLayout>

                        <!-- Job Type -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Job Type" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                                <Picker x:Name="JobTypePicker" Title="Select Type">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>Service Call</x:String>
                                            <x:String>Repair</x:String>
                                            <x:String>Maintenance</x:String>
                                            <x:String>Installation</x:String>
                                            <x:String>Diagnostic</x:String>
                                            <x:String>Warranty</x:String>
                                            <x:String>Callback</x:String>
                                            <x:String>Other</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Priority" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                                <Picker x:Name="PriorityPicker" Title="Select Priority">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>Low</x:String>
                                            <x:String>Normal</x:String>
                                            <x:String>High</x:String>
                                            <x:String>Urgent</x:String>
                                            <x:String>Emergency</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Description -->
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Problem Description" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                            <Editor x:Name="DescriptionEditor"
                                    Placeholder="Describe the issue or work to be done..."
                                    HeightRequest="80"
                                    FontSize="14"/>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Scheduling -->
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource LightCardBackground}, Dark={StaticResource DarkCardBackground}}" 
                        StrokeShape="RoundRectangle 12" 
                        Stroke="Transparent"
                        Padding="16">
                    <Border.Shadow>
                        <Shadow Brush="{AppThemeBinding Light=Black, Dark={StaticResource Gray900}}" Offset="0,2" Radius="4" Opacity="0.1"/>
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Scheduling" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"/>

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Date" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                                <DatePicker x:Name="ScheduledDatePicker"/>
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Time" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                                <TimePicker x:Name="ScheduledTimePicker"/>
                            </VerticalStackLayout>
                        </Grid>

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Estimated Hours" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                                <Entry x:Name="EstimatedHoursEntry" 
                                       Placeholder="e.g., 2"
                                       Keyboard="Numeric"/>
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Status" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                                <Picker x:Name="StatusPicker" Title="Select Status">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>Draft</x:String>
                                            <x:String>Scheduled</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                            </VerticalStackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Asset Selection (Optional) -->
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource LightCardBackground}, Dark={StaticResource DarkCardBackground}}" 
                        StrokeShape="RoundRectangle 12" 
                        Stroke="Transparent"
                        Padding="16">
                    <Border.Shadow>
                        <Shadow Brush="{AppThemeBinding Light=Black, Dark={StaticResource Gray900}}" Offset="0,2" Radius="4" Opacity="0.1"/>
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Related Equipment (Optional)" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                        <Picker x:Name="AssetPicker" Title="Select equipment if applicable"/>
                    </VerticalStackLayout>
                </Border>

                <!-- Internal Notes -->
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource LightCardBackground}, Dark={StaticResource DarkCardBackground}}" 
                        StrokeShape="RoundRectangle 12" 
                        Stroke="Transparent"
                        Padding="16">
                    <Border.Shadow>
                        <Shadow Brush="{AppThemeBinding Light=Black, Dark={StaticResource Gray900}}" Offset="0,2" Radius="4" Opacity="0.1"/>
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="12">
                        <Label Text="Financial Details (Optional)" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"/>

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Labor Total" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                                <Entry x:Name="LaborTotalEntry" 
                                       Placeholder="0.00"
                                       Keyboard="Numeric"
                                       Text="0.00"/>
                            </VerticalStackLayout>
                            <VerticalStackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Parts Total" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                                <Entry x:Name="PartsTotalEntry" 
                                       Placeholder="0.00"
                                       Keyboard="Numeric"
                                       Text="0.00"/>
                            </VerticalStackLayout>
                        </Grid>

                        <VerticalStackLayout Spacing="4">
                            <Label Text="Tax Rate (%)" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                            <Entry x:Name="TaxRateEntry" 
                                   Placeholder="7.0"
                                   Keyboard="Numeric"
                                   Text="7.0"/>
                        </VerticalStackLayout>

                        <!-- Tax Included Toggle -->
                        <HorizontalStackLayout Spacing="8">
                            <Switch x:Name="TaxIncludedSwitch" 
                                    OnColor="{StaticResource Primary}"
                                    ThumbColor="White"/>
                            <Label Text="Tax Already Included in Price" 
                                   FontSize="14" 
                                   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Internal Notes -->
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource LightCardBackground}, Dark={StaticResource DarkCardBackground}}" 
                        StrokeShape="RoundRectangle 12" 
                        Stroke="Transparent"
                        Padding="16">
                    <Border.Shadow>
                        <Shadow Brush="{AppThemeBinding Light=Black, Dark={StaticResource Gray900}}" Offset="0,2" Radius="4" Opacity="0.1"/>
                    </Border.Shadow>
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Internal Notes" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"/>
                        <Editor x:Name="InternalNotesEditor"
                                Placeholder="Notes for technician (not visible to customer)..."
                                HeightRequest="60"
                                FontSize="14"/>
                    </VerticalStackLayout>
                </Border>

                <!-- Spacer -->
                <BoxView HeightRequest="16"/>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Fixed Bottom Action Buttons -->
        <Border Grid.Row="1" 
                BackgroundColor="{AppThemeBinding Light={StaticResource LightCardBackground}, Dark={StaticResource DarkCardBackground}}" 
                Padding="16"
                StrokeShape="RoundRectangle 0"
                Stroke="Transparent">
            <Border.Shadow>
                <Shadow Brush="{AppThemeBinding Light=Black, Dark={StaticResource Gray900}}" Offset="0,-2" Radius="4" Opacity="0.1"/>
            </Border.Shadow>
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button Grid.Column="0"
                        Text="Cancel"
                        BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                        TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                        CornerRadius="8"
                        HeightRequest="50"
                        Clicked="OnCancelClicked"/>
                <Button Grid.Column="1"
                        Text="Create Job"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        FontAttributes="Bold"
                        CornerRadius="8"
                        HeightRequest="50"
                        Clicked="OnSaveClicked"/>
            </Grid>
        </Border>
    </Grid>

</ContentPage>
