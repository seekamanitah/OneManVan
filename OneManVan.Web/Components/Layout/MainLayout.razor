@inherits LayoutComponentBase

<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="top-row px-4 d-flex justify-content-end align-items-center gap-3">
            <ThemeToggle />
            <a href="https://learn.microsoft.com/aspnet/core/" target="_blank">About</a>
        </div>

        <article class="content px-4">
            <ErrorBoundary @ref="errorBoundary">
                <ChildContent>
                    @Body
                </ChildContent>
                <ErrorContent Context="ex">
                    <div class="alert alert-danger m-3">
                        <h5><i class="bi bi-exclamation-triangle-fill me-2"></i>Something went wrong</h5>
                        <p>An error occurred while rendering this page.</p>
                        <button class="btn btn-outline-danger btn-sm" @onclick="RecoverFromError">
                            <i class="bi bi-arrow-clockwise me-1"></i>Try Again
                        </button>
                        @if (ShowErrorDetails)
                        {
                            <details class="mt-2">
                                <summary class="text-muted small">Technical Details</summary>
                                <pre class="small bg-light p-2 mt-1 rounded">@ex.Message</pre>
                            </details>
                        }
                    </div>
                </ErrorContent>
            </ErrorBoundary>
        </article>
    </main>
</div>

@* PWA Install Banner *@
<PwaInstallBanner />

<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss" onclick="this.parentElement.style.display='none';">X</span>
</div>

@code {
    private ErrorBoundary? errorBoundary;
    
    // Set to true in Development, false in Production
    private bool ShowErrorDetails => 
#if DEBUG
        true;
#else
        false;
#endif

    private void RecoverFromError()
    {
        errorBoundary?.Recover();
    }
}
