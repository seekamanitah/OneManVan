@using OneManVan.Shared.Models

<div class="modal fade @(IsVisible ? "show d-block" : "")" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-file-pdf me-2"></i>PDF Options
                </h5>
                <button type="button" class="btn-close" @onclick="Cancel"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Content Options</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="includePrices" @bind="Options.IncludePrices" />
                        <label class="form-check-label" for="includePrices">
                            Include prices
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="showLaborBreakdown" @bind="Options.ShowLaborBreakdown" />
                        <label class="form-check-label" for="showLaborBreakdown">
                            Show labor breakdown (hours x rate)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="includeTax" @bind="Options.IncludeTax" />
                        <label class="form-check-label" for="includeTax">
                            Include tax breakdown
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="showSubtotal" @bind="Options.ShowSubtotal" />
                        <label class="form-check-label" for="showSubtotal">
                            Show subtotal
                        </label>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Display Format</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="displayFormat" id="itemized" 
                               checked="@(!Options.UseFlatRate)" @onchange="@(() => Options.UseFlatRate = false)" />
                        <label class="form-check-label" for="itemized">
                            Itemized (show all line items)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="displayFormat" id="flatRate" 
                               checked="@Options.UseFlatRate" @onchange="@(() => Options.UseFlatRate = true)" />
                        <label class="form-check-label" for="flatRate">
                            Flat rate (total only)
                        </label>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Header & Footer</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="includeCompanyHeader" @bind="Options.IncludeCompanyHeader" />
                        <label class="form-check-label" for="includeCompanyHeader">
                            Include company header
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="includeCustomerInfo" @bind="Options.IncludeCustomerInfo" />
                        <label class="form-check-label" for="includeCustomerInfo">
                            Include customer information
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="includePaymentTerms" @bind="Options.IncludePaymentTerms" />
                        <label class="form-check-label" for="includePaymentTerms">
                            Include payment terms
                        </label>
                    </div>
                </div>

                @if (ShowSupplyHouseOption)
                {
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Special Formats</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="supplyHouseFormat" @bind="Options.SupplyHouseFormat" />
                            <label class="form-check-label" for="supplyHouseFormat">
                                Supply house format (item, qty, notes only - no prices)
                            </label>
                        </div>
                    </div>
                }

                <div class="mb-0">
                    <label class="form-label fw-semibold">Privacy</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="hideInternalNotes" @bind="Options.HideInternalNotes" />
                        <label class="form-check-label" for="hideInternalNotes">
                            Hide internal notes
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" @onclick="Cancel">
                    Cancel
                </button>
                <button type="button" class="btn btn-primary" @onclick="Confirm">
                    <i class="bi bi-download me-2"></i>Generate PDF
                </button>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public bool IsVisible { get; set; }

    [Parameter]
    public EventCallback<bool> IsVisibleChanged { get; set; }

    [Parameter]
    public PdfOptions Options { get; set; } = new();

    [Parameter]
    public EventCallback<PdfOptions> OnConfirm { get; set; }

    [Parameter]
    public bool ShowSupplyHouseOption { get; set; } = false;

    private async Task Cancel()
    {
        IsVisible = false;
        await IsVisibleChanged.InvokeAsync(false);
    }

    private async Task Confirm()
    {
        await OnConfirm.InvokeAsync(Options);
        IsVisible = false;
        await IsVisibleChanged.InvokeAsync(false);
    }
}
