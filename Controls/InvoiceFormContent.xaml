<?xml version="1.0" encoding="utf-8"?>
<UserControl x:Class="OneManVan.Controls.InvoiceFormContent"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <StackPanel>
        <!-- Customer -->
        <TextBlock Text="Customer *" FontSize="12" FontWeight="SemiBold"
                   Foreground="{DynamicResource TextBrush}" Margin="0,0,0,4"/>
        <Grid Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <ComboBox x:Name="CustomerCombo"
                      Grid.Column="0"
                      Background="{DynamicResource SurfaceBrush}"
                      Foreground="{DynamicResource TextBrush}"
                      BorderBrush="{DynamicResource Surface2Brush}"
                      BorderThickness="1"
                      Padding="10,8"
                      FontSize="13"/>
            
            <Button x:Name="QuickAddCustomerButton"
                    Grid.Column="2"
                    Content="Quick Add"
                    Click="OnQuickAddCustomerClick"
                    Background="{DynamicResource SecondaryBrush}"
                    Foreground="White"
                    BorderThickness="0"
                    Padding="15,8"
                    FontSize="12"
                    FontWeight="SemiBold"
                    Cursor="Hand"
                    ToolTip="Create a new customer"
                    VerticalAlignment="Top">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="4"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </Grid>
        
        
        <!-- Invoice Date -->
        <TextBlock Text="Invoice Date *" FontSize="12" FontWeight="SemiBold"
                   Foreground="{DynamicResource TextBrush}" Margin="0,0,0,4"/>
        <DatePicker x:Name="InvoiceDatePicker"
                    Background="{DynamicResource SurfaceBrush}"
                    Foreground="{DynamicResource TextBrush}"
                    BorderBrush="{DynamicResource Surface2Brush}"
                    BorderThickness="1"
                    Padding="10,8"
                    FontSize="13"
                    Margin="0,0,0,15"/>
        
        <!-- Due Date -->
        <TextBlock Text="Due Date *" FontSize="12" FontWeight="SemiBold"
                   Foreground="{DynamicResource TextBrush}" Margin="0,0,0,4"/>
        <DatePicker x:Name="DueDatePicker"
                    Background="{DynamicResource SurfaceBrush}"
                    Foreground="{DynamicResource TextBrush}"
                    BorderBrush="{DynamicResource Surface2Brush}"
                    BorderThickness="1"
                    Padding="10,8"
                    FontSize="13"
                    Margin="0,0,0,15"/>
        
        <!-- LINE ITEMS SECTION -->
        <Border Background="{DynamicResource SurfaceBrush}"
                BorderBrush="{DynamicResource Surface2Brush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="15"
                Margin="0,0,0,15">
            <StackPanel>
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Text="Line Items" 
                               FontSize="16" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource TextBrush}"
                               VerticalAlignment="Center"/>
                    
                    <Button x:Name="AddFromProductsButton"
                            Grid.Column="1"
                            Content="Add from Products/Inventory"
                            Click="OnAddFromProductsClick"
                            Background="{DynamicResource PrimaryBrush}"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="12,6"
                            FontSize="12"
                            Cursor="Hand">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                    CornerRadius="4"
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Opacity" Value="0.9"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                    
                    <Button x:Name="AddCustomLineItemButton"
                            Grid.Column="3"
                            Content="Add Custom Item"
                            Click="OnAddCustomLineItemClick"
                            Background="{DynamicResource SecondaryBrush}"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="12,6"
                            FontSize="12"
                            Cursor="Hand">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}"
                                                    CornerRadius="4"
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Opacity" Value="0.9"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
                
                <!-- Line Items DataGrid -->
                <DataGrid x:Name="LineItemsDataGrid"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          Background="{DynamicResource BackgroundBrush}"
                          Foreground="{DynamicResource TextBrush}"
                          BorderBrush="{DynamicResource Surface2Brush}"
                          BorderThickness="1"
                          RowBackground="{DynamicResource BackgroundBrush}"
                          AlternatingRowBackground="{DynamicResource SurfaceBrush}"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="Column"
                          MinHeight="120"
                          MaxHeight="300">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Description" 
                                          Binding="{Binding Description}" 
                                          Width="*"
                                          MinWidth="200"/>
                        <DataGridTextColumn Header="Quantity" 
                                          Binding="{Binding Quantity, StringFormat=N2}" 
                                          Width="100"/>
                        <DataGridTextColumn Header="Unit Price" 
                                          Binding="{Binding UnitPrice, StringFormat=C2}" 
                                          Width="100"/>
                        <DataGridTextColumn Header="Total" 
                                          Binding="{Binding Total, StringFormat=C2}" 
                                          Width="100"
                                          IsReadOnly="True"/>
                        <DataGridTemplateColumn Header="Actions" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="Delete"
                                            Click="OnDeleteLineItemClick"
                                            Background="{DynamicResource ErrorBrush}"
                                            Foreground="White"
                                            BorderThickness="0"
                                            Padding="8,4"
                                            FontSize="11"
                                            Cursor="Hand"
                                            Tag="{Binding}">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}"
                                                                    CornerRadius="4"
                                                                    Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="Center"
                                                                                VerticalAlignment="Center"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Opacity" Value="0.9"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
                
                <!-- Empty State -->
                <TextBlock x:Name="EmptyLineItemsText"
                           Text="No line items added. Click 'Add from Products/Inventory' or 'Add Custom Item' to add items."
                           FontSize="12"
                           Foreground="{DynamicResource SubtextBrush}"
                           TextAlignment="Center"
                           Padding="20"
                           Visibility="Collapsed"/>
            </StackPanel>
        </Border>
        
        <!-- TOTALS SECTION -->
        <Border Background="{DynamicResource Surface2Brush}"
                CornerRadius="8"
                Padding="15"
                Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="Invoice Totals" 
                           FontSize="14" 
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource TextBrush}"
                           Margin="0,0,0,10"/>
                
                <!-- Subtotal -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Subtotal:" 
                               FontSize="13"
                               Foreground="{DynamicResource TextBrush}"/>
                    <TextBlock x:Name="SubtotalDisplay"
                               Grid.Column="1"
                               Text="$0.00" 
                               FontSize="13"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource TextBrush}"/>
                </Grid>
                
                <!-- Tax Rate Input -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Tax Rate (%):" 
                               FontSize="13"
                               Foreground="{DynamicResource TextBrush}"
                               VerticalAlignment="Center"/>
                    <TextBox x:Name="TaxRateTextBox"
                             Grid.Column="1"
                             Background="{DynamicResource SurfaceBrush}"
                             Foreground="{DynamicResource TextBrush}"
                             BorderBrush="{DynamicResource Surface2Brush}"
                             BorderThickness="1"
                             Padding="8,4"
                             FontSize="13"
                             TextChanged="OnTaxRateChanged"/>
                    <TextBlock x:Name="TaxAmountDisplay"
                               Grid.Column="3"
                               Text="$0.00" 
                               FontSize="13"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource TextBrush}"
                               VerticalAlignment="Center"/>
                </Grid>
                
                <!-- Tax Included Checkbox -->
                <CheckBox x:Name="TaxIncludedCheckBox"
                          Content="Tax Already Included in Price"
                          Foreground="{DynamicResource TextBrush}"
                          FontSize="12"
                          Margin="0,0,0,10"
                          Checked="OnTaxIncludedChanged"
                          Unchecked="OnTaxIncludedChanged"
                          ToolTip="Check this if the price already includes tax (flat rate with tax)"/>
                
                <Separator Background="{DynamicResource Surface2Brush}" 
                           Height="1" 
                           Margin="0,5,0,10"/>
                
                <!-- Total -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Total:" 
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="{DynamicResource TextBrush}"/>
                    <TextBlock x:Name="TotalDisplay"
                               Grid.Column="1"
                               Text="$0.00" 
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="{DynamicResource PrimaryBrush}"/>
                </Grid>
            </StackPanel>
        </Border>
        
        <!-- LEGACY FIELDS (Read-only for backward compatibility) -->
        <Border x:Name="LegacyFieldsPanel"
                Background="{DynamicResource BackgroundBrush}"
                BorderBrush="{DynamicResource WarningBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="15"
                Margin="0,0,0,15"
                Visibility="Collapsed">
            <StackPanel>
                <TextBlock Text="Legacy Invoice Format (Read-Only)" 
                           FontSize="13" 
                           FontWeight="SemiBold"
                           Foreground="{DynamicResource WarningBrush}"
                           Margin="0,0,0,10"/>
                <TextBlock Text="This invoice uses the old format with Labor and Parts amounts. These fields are shown for reference only."
                           FontSize="11"
                           Foreground="{DynamicResource SubtextBrush}"
                           TextWrapping="Wrap"
                           Margin="0,0,0,10"/>
        
        <!-- Labor Amount -->
        <TextBlock Text="Labor Amount" FontSize="12" FontWeight="SemiBold"
                   Foreground="{DynamicResource TextBrush}" Margin="0,0,0,4"/>
        <TextBox x:Name="LaborAmountTextBox"
                 Background="{DynamicResource SurfaceBrush}"
                 Foreground="{DynamicResource TextBrush}"
                 BorderBrush="{DynamicResource Surface2Brush}"
                 BorderThickness="1"
                 Padding="10,8"
                 FontSize="13"
                 IsReadOnly="True"
                 Margin="0,0,0,15"/>
        
        <!-- Parts Amount -->
        <TextBlock Text="Parts Amount" FontSize="12" FontWeight="SemiBold"
                   Foreground="{DynamicResource TextBrush}" Margin="0,0,0,4"/>
        <TextBox x:Name="PartsAmountTextBox"
                 Background="{DynamicResource SurfaceBrush}"
                 Foreground="{DynamicResource TextBrush}"
                 BorderBrush="{DynamicResource Surface2Brush}"
                 BorderThickness="1"
                 Padding="10,8"
                 FontSize="13"
                 IsReadOnly="True"
                 Margin="0,0,0,15"/>
            </StackPanel>
        </Border>
        
        <!-- Notes -->
        <TextBlock Text="Notes" FontSize="12" FontWeight="SemiBold"
                   Foreground="{DynamicResource TextBrush}" Margin="0,0,0,4"/>
        <TextBox x:Name="NotesTextBox"
                 Background="{DynamicResource SurfaceBrush}"
                 Foreground="{DynamicResource TextBrush}"
                 BorderBrush="{DynamicResource Surface2Brush}"
                 BorderThickness="1"
                 Padding="10,8"
                 FontSize="13"
                 Height="80"
                 TextWrapping="Wrap"
                 AcceptsReturn="True"
                 VerticalScrollBarVisibility="Auto"/>
    </StackPanel>
</UserControl>
